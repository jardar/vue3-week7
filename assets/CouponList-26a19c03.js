import{m as w,a as L,b as r,h as c,_ as M,o as m,c as p,d as e,t as u,w as h,v as _,j as A,r as b,e as C,F as I,g as B}from"./index-9d6383b5.js";import{s as D,u as v,a as y}from"./loading-b0bbf49d.js";import{P}from"./PaginationComp-95dcfef3.js";import{M as S}from"./bootstrap.esm-3171751b.js";import{T as k}from"./dateHelper-2825c04a.js";import{D as R}from"./DeleteDlg-adc64527.js";const $={props:["item"],emits:["update"],data(){return{selectedItem:{title:"",code:"",percent:0,due_date:0,is_enabled:0},dueDate:"1911-01-01",editModal:null,isImgLoading:!1}},watch:{item(){this.selectedItem={...this.item},this.dueDate=k(this.item.due_date*1e3,"-")},dueDate(){this.selectedItem.due_date=Math.floor(new Date(this.dueDate)/1e3)}},computed:{...w(v,["getContainLoading"])},methods:{...L(v,["setContainLoading"]),show(){this.editModal.show()},hide(){this.editModal.hide()},handleEditOrCreate(){this.$emit("update",{isNew:!this.selectedItem.id,data:this.selectedItem})},handleFileUpload(s,t=!1,a=0){var g;if((g=s.target)!=null&&g.files&&s.target.files.length>0){this.isImgLoading=!0;const o=s.target.files[0],l=new FormData;l.append("file-to-upload",o),r.post(`${c.epUploadFile}`,l).then(i=>{t?this.selectedItem.imageUrl=i.data.imageUrl:this.selectedItem.imagesUrl[a]=i.data.imageUrl}).catch(i=>{D(i.response.data.message||"error","error")}).finally(()=>{s.target.value="",this.isImgLoading=!1})}}},mounted(){this.isImgLoading=!1,this.editModal=new S(this.$refs.productModal,{keyboard:!1})}},E={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},G={class:"modal-dialog modal-xl"},O={class:"modal-content border-0"},V={class:"modal-header bg-dark text-white"},T={id:"productModalLabel",class:"modal-title"},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},N={class:"mb-3"},q=e("label",{for:"title",class:"form-label"},"標題",-1),z={class:"mb-3"},H=e("label",{for:"code",class:"form-label"},"優惠碼",-1),J={class:"mb-3"},K=e("label",{for:"due_date"},"到期日",-1),Q={class:"mb-3"},W=e("label",{for:"percent",class:"form-label"},"折扣百分比",-1),X={class:"mb-3 form-check"},Y=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Z={class:"modal-footer"},ee=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function te(s,t,a,g,o,l){var i,f;return m(),p("div",E,[e("div",G,[e("div",O,[e("div",V,[e("h5",T,[e("span",null,u((i=o.selectedItem)!=null&&i.id?"編輯":"新增")+"優惠券",1)]),F]),e("div",j,[e("div",N,[q,h(e("input",{id:"title",type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=d=>o.selectedItem.title=d)},null,512),[[_,o.selectedItem.title]])]),e("div",z,[H,h(e("input",{id:"code",type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=d=>o.selectedItem.code=d)},null,512),[[_,o.selectedItem.code]])]),e("div",J,[K,h(e("input",{id:"due_date",type:"date",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=d=>o.dueDate=d)},null,512),[[_,o.dueDate]])]),e("div",Q,[W,h(e("input",{id:"percent",type:"number",class:"form-control",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=d=>o.selectedItem.percent=d)},null,512),[[_,o.selectedItem.percent,void 0,{number:!0}]])]),e("div",X,[h(e("input",{id:"is_enabled",type:"checkbox",class:"form-check-input","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=d=>o.selectedItem.is_enabled=d)},null,512),[[A,o.selectedItem.is_enabled]]),Y])]),e("div",Z,[ee,e("button",{onClick:t[5]||(t[5]=(...d)=>l.handleEditOrCreate&&l.handleEditOrCreate(...d)),type:"button",class:"btn btn-primary"},u((f=o.selectedItem)!=null&&f.id?"更新":"新增")+"優惠券 ",1)])])])],512)}const se=M($,[["render",te]]),oe={components:{PageComp:P,EditCoupon:se,DeleteDlg:R},data(){return{items:[],selectedItem:{},page:{}}},computed:{...w(v,["getContainLoading"])},methods:{...L(v,["setContainLoading"]),resetSelected(){this.selectedItem={title:"",code:"",percent:0,due_date:0,is_enabled:0}},showCreateModal(){this.resetSelected(),this.$refs.editDlgRef.show()},showUpdateModal(s){this.selectedItem={...s},this.$refs.editDlgRef.show()},showDeleteModal(s){this.selectedItem={...s},this.$refs.deleteDlgRef.show()},handleEditOrCreate({isNew:s,data:t}){this.setContainLoading(!0),s?r.post(`${c.epAdmCreateCoupon}`,{data:t}).then(a=>{D(`${a.data.message}`),this.doGetAdminCouponsByPage()}).catch(a=>{y("失敗",a.response.data.message||"error","error")}).finally(()=>{this.resetSelected(),this.$refs.editDlgRef.hide(),this.setContainLoading(!1)}):r.put(c.epAdmUpdateCoupon(t.id),{data:t}).then(a=>{D(`${a.data.message}`),this.doGetAdminCouponsByPage()}).catch(a=>{y("失敗",a.response.data.message||"error","error")}).finally(()=>{this.resetSelected(),this.$refs.editDlgRef.hide(),this.setContainLoading(!1)})},handleDelete(s=!1){s&&(this.setContainLoading(!0),r.delete(c.epAdmDeleteCouponById(this.selectedItem.id)).then(t=>(D(`${t.data.message}`),r.get(c.epAdmGetCouponsByPage(1)))).then(t=>{this.page=t.data.pagination;const a=t.data.coupons;this.items=a?Object.values(a):[]}).catch(t=>{y("失敗",t.response.data.message||"error","error")}).finally(()=>{this.resetSelected(),this.$refs.deleteDlgRef.hide(),this.setContainLoading(!1)}))},handlePageChange(s){this.page.current_page!==s&&this.doGetAdminCouponsByPage(s)},doGetAdminCouponsByPage(s=1){this.setContainLoading(!0),r.get(c.epAdmGetCouponsByPage(s)).then(t=>{this.page=t.data.pagination;const a=t.data.coupons;this.items=a?Object.values(a):[]}).catch(t=>{y("失敗",t.response.data.message||"error","error")}).finally(()=>{this.setContainLoading(!1)})},ToSimpleDate:k},mounted(){this.doGetAdminCouponsByPage()}},ae={class:"table"},le=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"折扣百分比"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col",class:"text-center"},"是否啟用"),e("th",{scope:"col"},"編輯")])],-1),de={scope:"row"},ne={class:"text-center"},ie={key:0,class:"text-success"},re={key:1},ce={class:"btn-group btn-group-sm",role:"group","aria-label":"operations"},me=["onClick"],pe=["onClick"];function he(s,t,a,g,o,l){const i=b("vue-loading"),f=b("page-comp"),d=b("edit-coupon"),U=b("delete-dlg");return m(),p(I,null,[e("button",{type:"button",class:"btn btn-primary float-end",onClick:t[0]||(t[0]=(...n)=>l.showCreateModal&&l.showCreateModal(...n))}," 建立新的優惠券 "),e("table",ae,[C(i,{active:s.getContainLoading,"onUpdate:active":t[1]||(t[1]=n=>s.getContainLoading=n),"can-cancel":!1,"is-full-page":!1},null,8,["active"]),le,e("tbody",null,[(m(!0),p(I,null,B(o.items,n=>(m(),p("tr",{key:n.id},[e("th",de,u(n.title),1),e("td",null,u(n.percent)+"%",1),e("td",null,u(l.ToSimpleDate(n.due_date*1e3)),1),e("td",ne,[n.is_enabled===1?(m(),p("span",ie,"啟用")):(m(),p("span",re,"未啟用"))]),e("td",null,[e("div",ce,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:x=>l.showUpdateModal(n)}," 編輯 ",8,me),e("button",{type:"button",class:"btn btn-outline-danger",onClick:x=>l.showDeleteModal(n)}," 刪除 ",8,pe)])])]))),128))])]),C(f,{page:o.page,onChange:l.handlePageChange},null,8,["page","onChange"]),C(d,{ref:"editDlgRef",item:o.selectedItem,onUpdate:l.handleEditOrCreate},null,8,["item","onUpdate"]),C(U,{ref:"deleteDlgRef",title:o.selectedItem.title,onChange:l.handleDelete},null,8,["title","onChange"])],64)}const ye=M(oe,[["render",he]]);export{ye as default};

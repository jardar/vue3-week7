import{M as U}from"./bootstrap.esm-3171751b.js";import{_ as E,o as r,c,d as e,t as a,w as M,v as S,f as g,k as b,b as p,h as m,r as v,e as i,F as L,g as A,l as P,n as x,p as B,q as G}from"./index-9d6383b5.js";const O={props:["onAddToCart"],data(){return{myModal:{},pid:"",product:{},qty:1,isLoading:!1}},methods:{show(t){this.isLoading=!1,this.product=t,this.qty=1,this.myModal.show()},hide(){this.myModal.hide()},handleAdd(){this.isLoading=!0,this.onAddToCart(this.product.id,this.qty)}},mounted(){this.myModal=new U(this.$refs.productModal,{keyboard:!0})}},R={class:"modal fade",ref:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-xl",role:"document"},j={class:"modal-content border-0"},Q={class:"modal-header bg-dark text-white"},z={class:"modal-title",id:"exampleModalLabel"},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},$={class:"row"},J={class:"col-sm-6"},K=["src"],W={class:"col-sm-6"},X={class:"badge bg-primary rounded-pill"},Y={class:"h6"},Z={class:"h5"},ee={class:"input-group"},te={key:0,class:"fas fa-spinner fa-pulse"};function se(t,l,h,_,s,n){return r(),c("div",R,[e("div",N,[e("div",j,[e("div",Q,[e("h5",z,[e("span",null,a(s.product.title),1)]),F]),e("div",H,[e("div",$,[e("div",J,[e("img",{class:"img-fluid",src:s.product.imageUrl,alt:""},null,8,K)]),e("div",W,[e("span",X,a(),1),e("p",null,"商品描述："+a(s.product.description),1),e("p",null,"商品內容："+a(s.product.content),1),e("del",Y,"原價 "+a(s.product.origin_price)+" 元",1),e("div",Z,"現在只要 "+a(s.product.price)+" 元",1),e("div",null,[e("div",ee,[M(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":l[0]||(l[0]=f=>s.qty=f)},null,512),[[S,s.qty]]),e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=(...f)=>n.handleAdd&&n.handleAdd(...f))},[s.isLoading?(r(),c("i",te)):g("",!0),b(" 加入購物車 ")])])])])])])])])],512)}const oe=E(O,[["render",se]]);const{VITE_NAME:k,VITE_EMAIL:V}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jardar",BASE_URL:"/vue3-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},{VITE_TEL:w,VITE_ADDR:T,VITE_NOTE:D}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jardar",BASE_URL:"/vue3-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},le={components:{ProductDlg:oe},data(){return{products:[],isLoading:"",isAddLoading:"",isDelLoading:"",showLoading:!1,cart:{carts:[]},order:{name:k,email:V,tel:w,addr:T,note:D}}},methods:{clearOrderInfo(){this.order={name:k,email:V,tel:w,addr:T,note:D}},onSubmit(){this.isLoading=!0,p.post(m.epCreateOrder,{data:{user:{name:this.order.name,email:this.order.email,tel:this.order.tel,address:this.order.addr},message:this.order.note}}).then(t=>{alert("結帳成功"),this.doGetCart()}).catch(t=>{alert(`失敗:${t.response.data.message||"error"}`)}).finally(()=>{this.isLoading=!1})},handleMore(t){this.isLoading=t,p.get(m.epAProductById(t)).then(l=>{this.$refs.productDlg.show(l.data.product)}).catch(l=>{alert(`失敗:${l.response.data.message||"error"}`)}).finally(()=>{this.isLoading=""})},handleAddToCart(t,l=1){this.isAddLoading=t;const h=this.cart.carts.find(_=>_.product_id===t);h?this.handleQtyChange(h.id,t,h.qty+l):p.post(m.epAddToCart,{data:{product_id:t,qty:l}}).then(_=>{alert("加入購物車成功"),this.doGetCart()}).catch(_=>{alert(`失敗:${_.response.data.message||"error"}`)}).finally(()=>{this.$refs.productDlg.hide(),this.isAddLoading=""})},handleQtyChange(t,l,h){const _=this.cart.carts.find(s=>s.id===t);_.qty=h,this.showLoading=!0,p.put(m.epUpdateCart(t),{data:{product_id:l,qty:parseInt(h)}}).then(s=>{alert("數量更改成功"),this.doGetCart()}).catch(s=>{alert(`失敗:${s.response.data.message||"error"}`)}).finally(()=>{this.$refs.productDlg.hide(),this.isAddLoading="",this.showLoading=!1})},handleDelCart(t){this.isDelLoading=t,p.delete(m.epDeleteACart(t)).then(l=>{alert(l.data.message),this.doGetCart()}).catch(l=>{alert(`失敗:${l.response.data.message||"error"}`)}).finally(()=>{this.isDelLoading=""})},handleClearAllCart(){this.showLoading=!0,p.delete(m.epDeleteCarts).then(t=>{alert(t.data.message),this.doGetCart()}).catch(t=>{alert(`失敗:${t.response.data.message||"error"}`)}).finally(()=>{this.showLoading=!1})},doGetCart(){p.get(m.epGetCarts).then(t=>{this.cart=t.data.data}).catch(t=>{alert(`失敗:${t.response.data.message||"error"}`)}).finally(()=>{})}},mounted(){p.get(`${m.epAllProducts}`).then(t=>{this.products=t.data.products,this.doGetCart()}).catch(t=>{alert(`失敗:${t.response.data.message||"error"}`)}).finally(()=>{})}},u=t=>(B("data-v-b5ad6883"),t=t(),G(),t),ae={class:"container"},de={class:"mt-4"},ne={class:"table align-middle"},ie=u(()=>e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th")])],-1)),re={style:{width:"200px"}},ce=["src"],ue={class:"h6"},he={class:"h5"},_e={class:"btn-group btn-group-sm"},pe=["onClick"],me={key:0,class:"fas fa-spinner fa-pulse"},ge=["onClick"],fe={key:0,class:"fas fa-spinner fa-pulse"},be={class:"text-end"},ve={class:"table align-middle"},ye=u(()=>e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1)),Ce=["onClick"],xe={key:0,class:"fas fa-spinner fa-pulse"},Le={key:0,class:"text-success"},Ae={class:"input-group input-group-sm"},ke={class:"input-group mb-3"},Ve=["value","onBlur"],we={class:"input-group-text",id:"basic-addon2"},Te={class:"text-end"},De={class:"text-end"},Ee={key:0,class:"text-success"},Me=u(()=>e("td",{colspan:"4",class:"text-end"},"總計",-1)),Se={class:"text-end"},Ie=u(()=>e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1)),qe={class:"text-end text-success"},Ue={class:"my-5 row justify-content-center"},Pe={class:"mb-3"},Be=u(()=>e("label",{for:"email",class:"form-label"},"Email",-1)),Ge={class:"mb-3"},Oe=u(()=>e("label",{for:"name",class:"form-label"},"收件人姓名",-1)),Re={class:"mb-3"},Ne=u(()=>e("label",{for:"tel",class:"form-label"},"收件人電話",-1)),je={class:"mb-3"},Qe=u(()=>e("label",{for:"address",class:"form-label"},"收件人地址",-1)),ze={class:"mb-3"},Fe=u(()=>e("label",{for:"message",class:"form-label"},"留言",-1)),He={class:"text-end"},$e=["disabled"];function Je(t,l,h,_,s,n){const f=v("product-dlg"),I=v("vue-loading"),y=v("v-field"),C=v("error-message"),q=v("v-form");return r(),c(L,null,[e("div",ae,[e("div",de,[i(f,{ref:"productDlg","on-add-to-cart":n.handleAddToCart},null,8,["on-add-to-cart"]),i(I,{active:s.showLoading,"onUpdate:active":l[0]||(l[0]=o=>s.showLoading=o),activeModifiers:{sync:!0}},null,8,["active"]),e("table",ne,[ie,e("tbody",null,[(r(!0),c(L,null,A(s.products,o=>(r(),c("tr",{key:o.id},[e("td",re,[e("img",{src:o.imageUrl,alt:"prod.title",style:{height:"100px","background-size":"cover","background-position":"center"}},null,8,ce)]),e("td",null,a(o.title),1),e("td",null,[e("del",ue,"原價 "+a(o.origin_price)+" 元",1),e("div",he,"現在只要 "+a(o.price)+" 元",1)]),e("td",null,[e("div",_e,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:d=>n.handleMore(o.id)},[s.isLoading===o.id?(r(),c("i",me)):g("",!0),b(" 查看更多 ")],8,pe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:d=>n.handleAddToCart(o.id)},[s.isAddLoading===o.id?(r(),c("i",fe)):g("",!0),b(" 加到購物車 ")],8,ge)])])]))),128))])]),e("div",be,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:l[1]||(l[1]=(...o)=>n.handleClearAllCart&&n.handleClearAllCart(...o))}," 清空購物車 ")]),e("table",ve,[ye,e("tbody",null,[s.cart.carts?(r(!0),c(L,{key:0},A(s.cart.carts,o=>(r(),c("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:d=>n.handleDelCart(o.id)},[s.isDelLoading===o.id?(r(),c("i",xe)):g("",!0),b(" x ")],8,Ce)]),e("td",null,[b(a(o.product.title)+" ",1),o.product.origin_price>o.product.price?(r(),c("div",Le," 已套用優惠券 ")):g("",!0)]),e("td",null,[e("div",Ae,[e("div",ke,[e("input",{min:"1",type:"number",class:"form-control",value:o.qty,onBlur:d=>n.handleQtyChange(o.id,o.product_id,d.target.value)},null,40,Ve),e("span",we,a(o.product.unit),1)])])]),e("td",Te,a(o.product.price),1),e("td",De,[o.product.origin_price>o.product.price?(r(),c("small",Ee,"折扣價：")):g("",!0),b(" "+a(o.total),1)])]))),128)):g("",!0)]),e("tfoot",null,[e("tr",null,[Me,e("td",Se,a(s.cart.total),1)]),e("tr",null,[Ie,e("td",qe,a(s.cart.final_total),1)])])])]),e("div",Ue,[i(q,{ref:"form",class:"col-md-6",onSubmit:n.onSubmit},{default:P(({errors:o})=>[e("div",Pe,[Be,i(y,{id:"email",name:"email",type:"email",modelValue:s.order.email,"onUpdate:modelValue":l[2]||(l[2]=d=>s.order.email=d),class:x(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"required|email"},null,8,["modelValue","class"]),i(C,{name:"email",class:"invalid-feedback"})]),e("div",Ge,[Oe,i(y,{id:"name",name:"姓名",type:"text",modelValue:s.order.name,"onUpdate:modelValue":l[3]||(l[3]=d=>s.order.name=d),class:x(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),i(C,{name:"姓名",class:"invalid-feedback"})]),e("div",Re,[Ne,i(y,{id:"tel",name:"電話",type:"tel",modelValue:s.order.tel,"onUpdate:modelValue":l[4]||(l[4]=d=>s.order.tel=d),class:x(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"cellphone"},null,8,["modelValue","class"]),i(C,{name:"電話",class:"invalid-feedback"})]),e("div",je,[Qe,i(y,{id:"address",name:"地址",type:"text",modelValue:s.order.addr,"onUpdate:modelValue":l[5]||(l[5]=d=>s.order.addr=d),class:x(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),i(C,{name:"地址",class:"invalid-feedback"})]),e("div",ze,[Fe,M(e("textarea",{id:"message","onUpdate:modelValue":l[6]||(l[6]=d=>s.order.note=d),class:"form-control",cols:"30",rows:"10"},null,512),[[S,s.order.note]])]),e("div",He,[e("button",{type:"submit",class:"btn btn-danger",disabled:Object.keys(o).length>0}," 送出訂單 ",8,$e)])]),_:1},8,["onSubmit"])])]),i(f,{onAddToCart:n.handleAddToCart},null,8,["onAddToCart"])],64)}const Xe=E(le,[["render",Je],["__scopeId","data-v-b5ad6883"]]);export{Xe as default};

import{m as A,a as w,_ as k,o as d,c,d as e,t as _,w as r,v as m,F as D,g as L,f as U,j as B,b as h,h as p,r as C,e as y}from"./index-7326065b.js";import{u as v,a as g,s as I}from"./loading-d8cb59f2.js";import{P as V}from"./PaginationComp-ee6863d8.js";import{M as S}from"./bootstrap.esm-17b0a35d.js";import{T as M}from"./dateHelper-2825c04a.js";import{D as G}from"./DeleteDlg-be628d4c.js";const R={props:["item"],emits:["update"],data(){return{selectedItem:{author:"",description:"",content:"",create_at:0,isPublic:!1,tag:[],title:"",num:0},dueDate:"1911-01-01",editModal:null}},watch:{item(){this.selectedItem={...this.item},this.dueDate=M(this.item.create_at*1e3,"-")},dueDate(){this.selectedItem.create_at=Math.floor(new Date(this.dueDate)/1e3)}},computed:{...A(v,["getContainLoading"])},methods:{...w(v,["setContainLoading"]),show(){this.editModal.show()},hide(){this.editModal.hide()},handleEditOrCreate(){this.$emit("update",{isNew:!this.selectedItem.id,data:this.selectedItem})}},mounted(){this.editModal=new S(this.$refs.productModal,{keyboard:!1})}},E={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},O={class:"modal-dialog modal-xl"},T={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},j={id:"productModalLabel",class:"modal-title"},F=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},z={class:"row"},H={class:"col-sm-4 vl-parent"},J={class:"mb-3"},K=e("label",{for:"title",class:"form-label"},"標題",-1),Q={class:"mb-3"},W=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),X={class:"mb-3"},Y=e("label",{for:"author",class:"form-label"},"作者",-1),Z={class:"mb-3"},$=e("label",{for:"create_at",class:"form-label"},"文章建立日期",-1),ee={class:"col-sm-8"},te={class:"mb-3"},se=e("label",{class:"form-label"},"標籤",-1),oe={class:"row"},le={class:"input-group input-group-sm"},ae=["onUpdate:modelValue"],ne=["onClick"],ie={key:0,class:"col-sm-3"},de={class:"mb-3"},ce=e("label",{for:"description",class:"form-label"},"文章描述",-1),re={class:"mb-3"},me=e("label",{for:"content",class:"form-label"},"文章內容",-1),he={class:"mb-3"},pe={class:"form-check"},ue=e("label",{class:"form-check-label",for:"isPublic"},"是否公開",-1),ge={class:"modal-footer"},_e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function be(l,t,a,x,s,i){var b,f;return d(),c("div",E,[e("div",O,[e("div",T,[e("div",N,[e("h5",j,[e("span",null,_((b=s.selectedItem)!=null&&b.id?"編輯":"新增")+"貼文",1)]),F]),e("div",q,[e("div",z,[e("div",H,[e("div",J,[K,r(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.selectedItem.title=o),id:"title",type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[m,s.selectedItem.title]])]),e("div",Q,[W,r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.selectedItem.image=o),id:"image",type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[m,s.selectedItem.image]])]),e("div",X,[Y,r(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.selectedItem.author=o),id:"author",type:"text",class:"form-control",placeholder:"請輸入作者"},null,512),[[m,s.selectedItem.author]])]),e("div",Z,[$,r(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.dueDate=o),id:"create_at",type:"date",class:"form-control"},null,512),[[m,s.dueDate]])])]),e("div",ee,[e("div",te,[se,e("div",oe,[(d(!0),c(D,null,L(s.selectedItem.tag,(o,u)=>(d(),c("div",{class:"col-sm-3 mb-1",key:u},[e("div",le,[r(e("input",{"onUpdate:modelValue":n=>s.selectedItem.tag[u]=n,type:"text",class:"form-control",placeholder:"請輸入標籤"},null,8,ae),[[m,s.selectedItem.tag[u]]]),e("button",{class:"btn btn-outline-danger btn-sm",onClick:n=>this.selectedItem.tag.splice(u,1)}," x ",8,ne)])]))),128)),!s.selectedItem.tag||s.selectedItem.tag.length===0||s.selectedItem.tag[s.selectedItem.tag.length-1].length>0?(d(),c("div",ie,[e("button",{class:"btn btn-outline-primary btn-sm w-100",onClick:t[4]||(t[4]=o=>s.selectedItem.tag.push(""))}," 新增標籤 ")])):U("",!0)])]),e("div",de,[ce,r(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.selectedItem.description=o),id:"description",type:"text",class:"form-control",placeholder:"文章描述"},`
                `,512),[[m,s.selectedItem.description]])]),e("div",re,[me,r(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.selectedItem.content=o),id:"content",type:"text",class:"form-control",placeholder:"文章內容"},`
                `,512),[[m,s.selectedItem.content]])]),e("div",he,[e("div",pe,[r(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.selectedItem.isPublic=o),id:"isPublic",class:"form-check-input",type:"checkbox"},null,512),[[B,s.selectedItem.isPublic]]),ue])])])])]),e("div",ge,[_e,e("button",{onClick:t[8]||(t[8]=(...o)=>i.handleEditOrCreate&&i.handleEditOrCreate(...o)),type:"button",class:"btn btn-primary"},_((f=s.selectedItem)!=null&&f.id?"更新":"新增")+"貼文 ",1)])])])],512)}const fe=k(R,[["render",be]]),Ce={components:{PageComp:V,EditArticle:fe,DeleteDlg:G},data(){return{items:[],selectedItem:{},page:{}}},computed:{...A(v,["getContainLoading"])},methods:{...w(v,["setContainLoading"]),resetSelected(){this.selectedItem={author:"",description:"",content:"",create_at:0,isPublic:!1,tag:[],title:"",num:0}},showCreateModal(){this.resetSelected(),this.$refs.editDlgRef.show()},showUpdateModal(l){this.setContainLoading(!0),h.get(p.epAdmGetArticlesById(l.id)).then(t=>{console.log(t.data),this.selectedItem={...t.data.article},this.$refs.editDlgRef.show()}).catch(t=>{g("失敗",t.response.data.message||"error","error")}).finally(()=>{this.setContainLoading(!1)})},showDeleteModal(l){this.selectedItem={...l},this.$refs.deleteDlgRef.show()},handleEditOrCreate({isNew:l,data:t}){console.log("article=",t),this.setContainLoading(!0),l?h.post(`${p.epAdmCreateArticle}`,{data:t}).then(a=>{I(`${a.data.message}`),this.doGetAdminArticlesByPage()}).catch(a=>{g("失敗",a.response.data.message||"error","error")}).finally(()=>{this.resetSelected(),this.$refs.editDlgRef.hide(),this.setContainLoading(!1)}):h.put(p.epAdmUpdateArticle(t.id),{data:t}).then(a=>{I(`${a.data.message}`),this.doGetAdminArticlesByPage()}).catch(a=>{g("失敗",a.response.data.message||"error","error")}).finally(()=>{this.resetSelected(),this.$refs.editDlgRef.hide(),this.setContainLoading(!1)})},handleDelete(l=!1){l&&(this.setContainLoading(!0),h.delete(p.epAdmDeleteArticleById(this.selectedItem.id)).then(t=>(I(`${t.data.message}`),h.get(p.epAdmGetArticlesByPage(1)))).then(t=>{console.log(t.data),this.page=t.data.pagination;const a=t.data.articles;this.items=a?Object.values(a):[]}).catch(t=>{g("失敗",t.response.data.message||"error","error")}).finally(()=>{this.resetSelected(),this.$refs.deleteDlgRef.hide(),this.setContainLoading(!1)}))},handlePageChange(l){this.page.current_page!==l&&this.doGetAdminCouponsByPage(l)},doGetAdminArticlesByPage(l=1){this.setContainLoading(!0),h.get(p.epAdmGetArticlesByPage(l)).then(t=>{console.log(t.data),this.page=t.data.pagination;const a=t.data.articles;this.items=a?Object.values(a):[]}).catch(t=>{g("失敗",t.response.data.message||"error","error")}).finally(()=>{this.setContainLoading(!1)})},doGetAdminArticleById(l){this.setContainLoading(!0),h.get(p.epAdmGetArticlesById(l)).then(t=>{console.log(t.data),this.selectedItem=t.data.article}).catch(t=>{g("失敗",t.response.data.message||"error","error")}).finally(()=>{this.setContainLoading(!1)})},ToSimpleDate:M},mounted(){this.doGetAdminArticlesByPage()}},ye={class:"table"},ve=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"標題"),e("th",{scope:"col"},"作者"),e("th",{scope:"col"},"描述"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col",class:"text-center"},"是否公開"),e("th",{scope:"col"},"編輯")])],-1),Ie={scope:"row"},De={class:"text-center"},Ae={key:0,class:"text-success"},we={key:1},ke={class:"btn-group btn-group-sm",role:"group","aria-label":"operations"},Le=["onClick"],Me=["onClick"];function xe(l,t,a,x,s,i){const b=C("vue-loading"),f=C("page-comp"),o=C("edit-article"),u=C("delete-dlg");return d(),c(D,null,[e("button",{type:"button",class:"btn btn-primary float-end",onClick:t[0]||(t[0]=(...n)=>i.showCreateModal&&i.showCreateModal(...n))}," 建立新的頁面 "),e("table",ye,[y(b,{active:l.getContainLoading,"onUpdate:active":t[1]||(t[1]=n=>l.getContainLoading=n),"can-cancel":!1,"is-full-page":!1},null,8,["active"]),ve,e("tbody",null,[(d(!0),c(D,null,L(s.items,n=>(d(),c("tr",{key:n.id},[e("th",Ie,_(n.title),1),e("td",null,_(n.author),1),e("td",null,_(n.description),1),e("td",null,_(i.ToSimpleDate(n.create_at*1e3)),1),e("td",De,[n.isPublic?(d(),c("span",Ae,"公開")):(d(),c("span",we,"未公開"))]),e("td",null,[e("div",ke,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:P=>i.showUpdateModal(n)}," 編輯 ",8,Le),e("button",{type:"button",class:"btn btn-outline-danger",onClick:P=>i.showDeleteModal(n)}," 刪除 ",8,Me)])])]))),128))])]),y(f,{page:s.page,onChange:i.handlePageChange},null,8,["page","onChange"]),y(o,{ref:"editDlgRef",item:s.selectedItem,onUpdate:i.handleEditOrCreate},null,8,["item","onUpdate"]),y(u,{ref:"deleteDlgRef",title:s.selectedItem.title,onChange:i.handleDelete},null,8,["title","onChange"])],64)}const Re=k(Ce,[["render",xe]]);export{Re as default};
